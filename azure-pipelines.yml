variables:
- group: 'databricks'

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- script: env | sort
  displayName: 'Environment / Context'

- task: UsePythonVersion@0
  displayName: 'Use Python 3.7'
  inputs:
    versionSpec: 3.7

- checkout: self
  persistCredentials: true
  clean: true
  displayName: 'Checkout & Build.Reason: $(Build.Reason) & Build.SourceBranchName: $(Build.SourceBranchName)'

- script: |
    python -m pip install --upgrade databricks-cli
  displayName: 'Install dependencies'

- script: |
        echo "Checking out the $(Build.SourceBranchName) branch"
        databricks repos update --path /Repos/QA/azure-databricks-mlops --branch "$(Build.SourceBranchName)"
  env:
    DATABRICKS_HOST: $(databricks-host)
    DATABRICKS_TOKEN: $(databricks-token)
  displayName: 'Update Staging environment'
